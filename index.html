<!DOCTYPE html>
<html lang="pt-br">
<head>
  <!-- ... (mantenha todo o head original) ... -->
</head>
<body>
  <!-- ... (mantenha toda a estrutura HTML original) ... -->

  <script>
    // Produtos iniciais (mantenha o array original)
    
    // Função para inicializar o localStorage
    function initializeStorage() {
      try {
        const storedProducts = JSON.parse(localStorage.getItem('products'));
        if (!Array.isArray(storedProducts)) {
          localStorage.setItem('products', JSON.stringify(initialProducts));
        }
      } catch (e) {
        localStorage.setItem('products', JSON.stringify(initialProducts));
      }
    }

    // Função para gerar HTML de um produto - CORRIGIDA
    function generateProductHTML(product) {
      return `
        <div class="product" data-category="${product.category}" data-price="${product.price}">
          ${product.badge ? `<span class="badge">${product.badge}</span>` : ''}
          ${product.lowStock || product.stock <= 5 ? `<span class="stock-badge">Baixo Estoque</span>` : ''}
          <img src="${product.image}" srcset="${product.image.replace('w=600', 'w=300')} 300w, ${product.image} 600w" sizes="(max-width: 600px) 300px, 600px" alt="${product.name}" loading="lazy">
          <div class="product-content">
            <h2>${product.name}</h2>
            <p>${product.description}</p>
            <p class="price">R$ ${product.price.toFixed(2)}</p>
          </div>
          <a class="whatsapp-button" href="https://wa.me/5585999704254?text=Oi%2C+tenho+interesse+no+${encodeURIComponent(product.name)}" target="_blank">
            <i class="fab fa-whatsapp"></i> Pedir via WhatsApp
          </a>
        </div>
      `;
    }

    // Carregar produtos dinamicamente - ATUALIZADA
    function loadProducts() {
      initializeStorage(); // Garante que o localStorage está inicializado
      
      let products;
      try {
        products = JSON.parse(localStorage.getItem('products'));
        if (!Array.isArray(products)) {
          products = initialProducts;
          localStorage.setItem('products', JSON.stringify(products));
        }
      } catch (e) {
        products = initialProducts;
        localStorage.setItem('products', JSON.stringify(products));
      }

      const wheyGrid = document.querySelector('#wheyGrid');
      const creatinaGrid = document.querySelector('#creatinaGrid');
      const preTreinoGrid = document.querySelector('#preTreinoGrid');
      const carousel = document.querySelector('#carousel');

      wheyGrid.innerHTML = '';
      creatinaGrid.innerHTML = '';
      preTreinoGrid.innerHTML = '';
      carousel.innerHTML = '';

      products.forEach(product => {
        const productHTML = generateProductHTML(product);
        if (product.category === 'whey') {
          wheyGrid.insertAdjacentHTML('beforeend', productHTML);
        } else if (product.category === 'creatina') {
          creatinaGrid.insertAdjacentHTML('beforeend', productHTML);
        } else if (product.category === 'pre-treino') {
          preTreinoGrid.insertAdjacentHTML('beforeend', productHTML);
        }
        if (product.badge || product.lowStock || product.stock <= 5) {
          carousel.insertAdjacentHTML('beforeend', `<div class="carousel-item">${productHTML}</div>`);
        }
      });

      applyFiltersAndSearch();
      updateCarousel();
    }

    // Admin Login - ATUALIZADA
    const loginSection = document.querySelector('#loginSection');
    const adminPanel = document.querySelector('#adminPanel');
    const adminLink = document.querySelector('#adminLink');
    const loginError = document.querySelector('#loginError');

    adminLink.addEventListener('click', (e) => {
      e.preventDefault();
      // Esconde todas as seções principais
      document.querySelectorAll('section:not(#loginSection):not(#adminPanel), .product-grid, .carousel, .header, .info-bar, .filters, .search-bar, .newsletter, .footer').forEach(el => {
        el.style.display = 'none';
      });
      loginSection.style.display = 'block';
      adminPanel.style.display = 'none';
    });

    function handleLogin() {
      const username = document.querySelector('#adminUsername').value;
      const password = document.querySelector('#adminPassword').value;

      // Credenciais fixas (em um sistema real, isso seria inseguro)
      const adminCredentials = { username: 'admin', password: '86800624' };

      if (username === adminCredentials.username && password === adminCredentials.password) {
        loginSection.style.display = 'none';
        adminPanel.style.display = 'block';
        loadAdminProducts();
        loginError.textContent = '';
      } else {
        loginError.textContent = 'Usuário ou senha incorretos!';
      }
    }

    function logout() {
      adminPanel.style.display = 'none';
      // Mostra todas as seções principais novamente
      document.querySelectorAll('section:not(#loginSection):not(#adminPanel), .product-grid, .carousel, .header, .info-bar, .filters, .search-bar, .newsletter, .footer').forEach(el => {
        el.style.display = '';
      });
      loadProducts();
    }

    // Admin Product Management - ATUALIZADA
    function loadAdminProducts() {
      let products;
      try {
        products = JSON.parse(localStorage.getItem('products'));
        if (!Array.isArray(products)) {
          products = initialProducts;
          localStorage.setItem('products', JSON.stringify(products));
        }
      } catch (e) {
        products = initialProducts;
        localStorage.setItem('products', JSON.stringify(products));
      }

      productTable.innerHTML = '';
      products.forEach(product => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${product.name}</td>
          <td>${product.description}</td>
          <td>R$ ${product.price.toFixed(2)}</td>
          <td>${product.stock}</td>
          <td>${product.category}</td>
          <td>${product.badge || '-'}</td>
          <td>
            <button class="edit" onclick="editProduct('${product.id}')">Editar</button>
            <button onclick="deleteProduct('${product.id}')">Excluir</button>
          </td>
        `;
        productTable.appendChild(row);
      });
    }

    // Garante que as funções estejam no escopo global para os eventos onclick
    window.editProduct = function(id) {
      let products;
      try {
        products = JSON.parse(localStorage.getItem('products'));
      } catch (e) {
        products = [];
      }
      const product = products.find(p => p.id === id);
      if (product) {
        document.querySelector('#productId').value = product.id;
        document.querySelector('#productName').value = product.name;
        document.querySelector('#productDescription').value = product.description;
        document.querySelector('#productPrice').value = product.price;
        document.querySelector('#productStock').value = product.stock;
        document.querySelector('#productImage').value = product.image;
        document.querySelector('#productCategory').value = product.category;
        document.querySelector('#productBadge').value = product.badge || '';
        
        // Rola para o formulário
        document.querySelector('#productForm').scrollIntoView({ behavior: 'smooth' });
      }
    };

    window.deleteProduct = function(id) {
      if (confirm('Tem certeza que deseja excluir este produto?')) {
        let products;
        try {
          products = JSON.parse(localStorage.getItem('products'));
        } catch (e) {
          products = [];
        }
        products = products.filter(p => p.id !== id);
        localStorage.setItem('products', JSON.stringify(products));
        loadAdminProducts();
        loadProducts();
      }
    };

    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
      initializeStorage();
      loadProducts();
      
      // Esconde o painel de admin inicialmente
      loginSection.style.display = 'none';
      adminPanel.style.display = 'none';
      
      // Configura o evento de submit do formulário
      productForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = document.querySelector('#productId').value || Date.now().toString();
        const name = document.querySelector('#productName').value.trim();
        const description = document.querySelector('#productDescription').value.trim();
        const price = parseFloat(document.querySelector('#productPrice').value);
        const stock = parseInt(document.querySelector('#productStock').value);
        const image = document.querySelector('#productImage').value.trim();
        const category = document.querySelector('#productCategory').value;
        const badge = document.querySelector('#productBadge').value.trim();

        // Validação
        if (!name || !description || isNaN(price) || price < 0 || isNaN(stock) || stock < 0 || !image || !category) {
          alert('Por favor, preencha todos os campos obrigatórios com valores válidos.');
          return;
        }

        let products;
        try {
          products = JSON.parse(localStorage.getItem('products'));
          if (!Array.isArray(products)) {
            products = [];
          }
        } catch (e) {
          products = [];
        }

        const productIndex = products.findIndex(p => p.id === id);
        const newProduct = {
          id,
          name,
          description,
          price,
          stock,
          image,
          category,
          badge,
          lowStock: stock <= 5
        };

        if (productIndex >= 0) {
          products[productIndex] = newProduct;
        } else {
          products.push(newProduct);
        }

        localStorage.setItem('products', JSON.stringify(products));
        productForm.reset();
        document.querySelector('#productId').value = '';
        loadAdminProducts();
        loadProducts();
      });
    });

    // ... (mantenha o restante das funções originais como applyFiltersAndSearch, updateCarousel, etc)
  </script>
</body>
</html>
